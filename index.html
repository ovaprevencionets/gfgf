<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Guardar IP en Firebase</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  button {
    padding: 12px 20px;
    font-size: 16px;
    cursor: pointer;
  }
  #estado {
    margin-top: 15px;
  }
</style>
</head>
<body>

<h2>¬øAceptas guardar tu IP?</h2>
<button id="guardar">Aceptar</button>
<p id="estado"></p>

<script type="module">
  // üîπ Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { 
    getFirestore, 
    collection, 
    addDoc, 
    serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  // üîπ Configuraci√≥n Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBkqQAe7RgEphm_2MBob-2SEsQMDTQkx4c",
    authDomain: "studio-2168264306-abb55.firebaseapp.com",
    projectId: "studio-2168264306-abb55",
    storageBucket: "studio-2168264306-abb55.firebasestorage.app",
    messagingSenderId: "165026938248",
    appId: "1:165026938248:web:e32ac2f9122ec33fb28e3d"
  };

  // üîπ Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  document.getElementById("guardar").addEventListener("click", async () => {
    const estado = document.getElementById("estado");
    estado.innerText = "Guardando IP...";

    try {
      // 1Ô∏è‚É£ Obtener IP real
      const res = await fetch("https://api.ipify.org?format=json");
      const data = await res.json();

      // 2Ô∏è‚É£ Guardar en Firestore
      await addDoc(collection(db, "ips"), {
        ip: data.ip,
        consentimiento: true,
        fecha: serverTimestamp()
      });

      estado.innerText = "‚úÖ IP guardada correctamente";
    } catch (error) {
      estado.innerText = "‚ùå Error: " + error.message;
    }
  });
</script>

</body>
</html>
